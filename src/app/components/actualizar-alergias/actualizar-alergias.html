<!-- ===== HU12 - Actualizar Antecedentes y Alergias ===== -->

<div class="container">
  <h2>Actualizar Antecedentes y Alergias</h2>

  <form (ngSubmit)="guardarCambios()" #formulario="ngForm">
    <div class="form-group">
      <label for="idCentroMedico">ID Centro Médico:</label>
      <input
        type="number"
        id="idCentroMedico"
        name="idCentroMedico"
        [(ngModel)]="historial.idCentroMedico"
        required
      />
    </div>

    <div class="form-group">
      <label for="idProfesional">ID Profesional:</label>
      <input
        type="number"
        id="idProfesional"
        name="idProfesional"
        [(ngModel)]="historial.idProfesional"
        required
      />
    </div>

    <div class="form-group">
      <label for="fechaConsulta">Fecha de Consulta:</label>
      <input
        type="date"
        id="fechaConsulta"
        name="fechaConsulta"
        [(ngModel)]="historial.fechaConsulta"
        required
      />
    </div>

    <div class="form-group">
      <label for="alergias">Alergias:</label>
      <textarea
        id="alergias"
        name="alergias"
        [(ngModel)]="historial.alergias"
        placeholder="Ejemplo: Polvo, Penicilina..."
        rows="3"
      ></textarea>
    </div>

    <div class="form-group">
      <label for="diagnostico">Diagnóstico:</label>
      <textarea
        id="diagnostico"
        name="diagnostico"
        [(ngModel)]="historial.diagnostico"
        placeholder="Describe el diagnóstico del paciente"
        rows="3"
      ></textarea>
    </div>

    <div class="form-group">
      <label for="tratamiento">Tratamiento:</label>
      <textarea
        id="tratamiento"
        name="tratamiento"
        [(ngModel)]="historial.tratamiento"
        placeholder="Indica el tratamiento sugerido"
        rows="3"
      ></textarea>
    </div>

    <div class="botones">
      <button type="submit" [disabled]="formulario.invalid">Guardar</button>
      <button type="button" (click)="limpiarCampos()">Limpiar</button>
    </div>
  </form>

  <hr />

  <!-- Tabla de mantenimiento (rol administrador) -->
  <section class="tabla-resultados" *ngIf="listaAlergias.length > 0; else sinDatos">
    <h3>Lista de Alergias Registradas</h3>
    <table>
      <thead>
      <tr>
        <th>ID Centro</th>
        <th>ID Profesional</th>
        <th>Fecha</th>
        <th>Alergias</th>
        <th>Diagnóstico</th>
        <th>Tratamiento</th>
        <th>Acciones</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let a of listaAlergias; let i = index">
        <td>{{ a.idCentroMedico }}</td>
        <td>{{ a.idProfesional }}</td>
        <td>{{ a.fechaConsulta }}</td>
        <td>{{ a.alergias }}</td>
        <td>{{ a.diagnostico }}</td>
        <td>{{ a.tratamiento }}</td>
        <td>
          <button (click)="editar(i)">Editar</button>
          <button (click)="eliminar(i)" style="background-color: #e74c3c;">
            Eliminar
          </button>
        </td>
      </tr>
      </tbody>
    </table>
  </section>

  <ng-template #sinDatos>
    <p style="text-align: center; color: #666;">No hay registros de alergias disponibles.</p>
  </ng-template>
</div>
