<!-- registro-consulta.component.html -->
<div class="consulta-container animate-fade-in">
  <h1>Registro de Consulta</h1>

  <form [formGroup]="consultaForm" (ngSubmit)="onSubmit()">
    <!-- Paciente -->
    <div class="form-group">
      <label for="paciente">Paciente</label>
      <select id="paciente" formControlName="idPaciente">
        <option value="" disabled selected>Seleccione un paciente</option>
        <option *ngFor="let p of pacientes" [value]="p.idPaciente">{{ p.nombres }} {{ p.apellidos }}</option>
      </select>
    </div>

    <!-- Profesional -->
    <div class="form-group">
      <label for="profesional">Profesional de Salud</label>
      <select id="profesional" formControlName="idProfesional">
        <option value="" disabled selected>Seleccione un profesional</option>
        <option *ngFor="let d of profesionales" [value]="d.idProfesional">{{ d.nombres }} {{ d.apellidos }}</option>
      </select>
    </div>

    <!-- Centro Médico -->
    <div class="form-group">
      <label for="centro">Centro Médico</label>
      <select id="centro" formControlName="idCentroMedico">
        <option value="" disabled selected>Seleccione un centro médico</option>
        <option *ngFor="let c of centros" [value]="c.idCentro">{{ c.nombre }}</option>
      </select>
    </div>

    <!-- Fecha -->
    <div class="form-group">
      <label for="fechaConsulta">Fecha</label>
      <input type="date" id="fechaConsulta" formControlName="fechaConsulta" />
    </div>

    <!-- Diagnósticos dinámicos -->
    <div class="subsection">
      <h2>Diagnósticos</h2>
      <div *ngFor="let diag of diagnosticos.controls; let i = index" class="dynamic-item">
        <input type="text" placeholder="Descripción" [formControlName]="i" />
        <button type="button" (click)="removeDiagnostico(i)">X</button>
      </div>
      <button type="button" class="add-btn" (click)="addDiagnostico()">+ Agregar diagnóstico</button>
    </div>

    <!-- Recetas dinámicas -->
    <div class="subsection">
      <h2>Recetas</h2>
      <div *ngFor="let receta of recetas.controls; let r = index" class="receta-block">
        <h3>Receta {{ r + 1 }}</h3>
        <input type="text" placeholder="Indicaciones" formControlName="indicaciones" [formGroup]="receta" />

        <div formArrayName="medicamentos" class="medicamentos-list">
          <div *ngFor="let med of receta.get('medicamentos').controls; let m = index" class="dynamic-item">
            <select [formControlName]="m">
              <option disabled selected>Seleccione medicamento</option>
              <option *ngFor="let medObj of medicamentos" [value]="medObj.idMedicamento">{{ medObj.nombre }}</option>
            </select>
            <button type="button" (click)="removeMedicamento(r, m)">X</button>
          </div>
        </div>

        <button type="button" class="add-btn" (click)="addMedicamento(r)">+ Agregar medicamento</button>
      </div>
      <button type="button" class="add-btn" (click)="addReceta()">+ Agregar receta</button>
    </div>

    <div class="submit-container">
      <button type="submit" class="submit-btn" [disabled]="consultaForm.invalid">Registrar Consulta</button>
    </div>
  </form>
</div>
